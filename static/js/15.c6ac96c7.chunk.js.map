{"version":3,"sources":["stores/PersonalChatStore.js","components/PersonalChat/PersonalChat.js"],"names":["PersonalChatStore","_this","Object","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__","this","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__","call","init","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__","D_Apps_projectmegaindia_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default","a","mark","_callee","wrap","_context","prev","next","getChatsMetas","chatMeta","sent","console","log","isReady","emit","stop","getChatMetaIds","_callee2","_context2","abrupt","getField","_ref3","_callee3","id","key","snapshot","_context3","firebase","ready","database","ref","concat","once","val","_x","_x2","apply","arguments","getSingleChatMeta","_ref4","_callee4","_ref5","_ref6","title","slug","isLeaf","_context4","Promise","all","map","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","ChatMeta","_x3","getChatMetaItem","otherUidSlug","myUid","AuthStore","user","uid","uid1","uid2","trySetChatToUserData","_callee5","ids","_context5","getChatSubjectsFlat","_callee6","_context6","slice","sort","amountOfSlashesSort","getChatSubjects","_callee7","subjectsArray","subjects","_context7","forEach","subject","nestChatSubject","getChatThread","_ref10","_callee8","chatThread","_context8","Error","threads","ChatThread","fromChatMeta","_x4","getAllPersonalChats","_callee9","chats","_context9","readyPromise","isAuthenticated","keys","chat","filter","blocked","_ref12","_callee10","otherUserUid","_context10","set","_x5","setTimeout","_callee11","_context11","t0","t1","AbstractChatStore","__webpack_exports__","PersonalChat","props","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","D_Apps_projectmegaindia_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","state","react__WEBPACK_IMPORTED_MODULE_5___default","createElement","className","_Chat_Chat__WEBPACK_IMPORTED_MODULE_7__","assign","chatStore","Component"],"mappings":"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","file":"static/js/15.c6ac96c7.chunk.js","sourcesContent":["import { EventEmitter } from \"events\";\r\nimport { ChatMeta } from \"../lib/chats/chat-meta\";\r\nimport { ChatThread } from \"../lib/chats/chat-thread\";\r\nimport AbstractChatStore from \"./AbstractChatStore\";\r\nimport AuthStore from \"./AuthStore\";\r\nimport firebase from '../lib/firebase';\r\n\r\nclass PersonalChatStore extends AbstractChatStore {\r\n    constructor() {\r\n        super();\r\n\r\n        this.threads = {};\r\n        this.init();\r\n\r\n        setTimeout(async () => {\r\n            console.log(await this.getAllPersonalChats());\r\n        }, 3000);\r\n    }\r\n\r\n    init = async () => {\r\n        this.chatMeta = await this.getChatsMetas();\r\n        console.log(this.chatMeta);\r\n        this.isReady = true;\r\n        this.emit('change');\r\n    }\r\n\r\n    getChatMetaIds = async () => {\r\n        return [];\r\n    }\r\n\r\n    getField = async (id, key) => {\r\n        await firebase.ready;\r\n        const snapshot = await firebase.database().ref(`/chats/personal/${id}/${key}`).once('value');\r\n        return snapshot.val();\r\n    }\r\n\r\n    getSingleChatMeta = async (id) => {\r\n        await firebase.ready;\r\n        const [title, slug, isLeaf] = await Promise.all(\r\n            ['title', 'slug', 'isLeaf'].map(key => this.getField(id, key))\r\n        );\r\n        return new ChatMeta(title, isLeaf, slug, id);\r\n    }\r\n\r\n    getChatMetaItem = otherUidSlug => {\r\n        console.log('getChatMetaItem', otherUidSlug);\r\n        const myUid = AuthStore.user.uid;\r\n        const uid1 = myUid > otherUidSlug ? otherUidSlug : myUid;\r\n        const uid2 = myUid > otherUidSlug ? myUid : otherUidSlug;\r\n        this.trySetChatToUserData(otherUidSlug);\r\n        return {\r\n            \"title\": \"\",\r\n            \"isLeaf\": false,\r\n            \"slug\": otherUidSlug,\r\n            \"id\": `${uid1}/${uid2}`\r\n        };\r\n    }\r\n\r\n    getChatsMetas = async () => {\r\n        await firebase.ready;\r\n        const ids = await this.getChatMetaIds();\r\n        return await Promise.all(ids.map(this.getSingleChatMeta));\r\n    };\r\n\r\n    getChatSubjectsFlat = async () => {\r\n        const chatMeta = await this.getChatsMetas();\r\n        return chatMeta.slice().sort(this.amountOfSlashesSort);\r\n    };\r\n\r\n    getChatSubjects = async () => {\r\n        const subjectsArray = await this.getChatSubjectsFlat();\r\n        const subjects = [];\r\n        subjectsArray.forEach(subject => this.nestChatSubject(subject, subjects));\r\n        return subjects;\r\n    };\r\n\r\n    getChatThread = async chatMeta => {\r\n        if (chatMeta === null) throw new Error('Invalid chat meta');\r\n        if (this.threads[chatMeta.id]) return this.threads[chatMeta.id];\r\n        await firebase.ready;\r\n        const chatThread = ChatThread.fromChatMeta(chatMeta, firebase.database().ref(`/chats/personal/${chatMeta.id}/thread`));\r\n        this.threads[chatMeta.id] = chatThread;\r\n        return chatThread;\r\n    };\r\n\r\n    getAllPersonalChats = async () => {\r\n        await firebase.ready;\r\n        await AuthStore.readyPromise;\r\n        const loggedIn = AuthStore.isAuthenticated;\r\n        if (!loggedIn) return null;\r\n        const snapshot = await firebase.database()\r\n            .ref(`/users/${AuthStore.user.uid}/personalchatswithusers`)\r\n            .once('value');\r\n        const chats = snapshot.val() || {};\r\n        return Object.keys(chats).map(key => {\r\n            const chat = chats[key];\r\n            chat.uid = key;\r\n            return chat;\r\n        }).filter(chat => chat.blocked !== true);\r\n    }\r\n\r\n    trySetChatToUserData = async (otherUserUid) => {\r\n        await firebase.ready;\r\n        await AuthStore.readyPromise;\r\n        const loggedIn = AuthStore.isAuthenticated;\r\n        if (!loggedIn) return false;\r\n        const snapshot = await firebase.database()\r\n            .ref(`/users/${AuthStore.user.uid}/personalchatswithusers/${otherUserUid}`)\r\n            .once('value');\r\n        if (snapshot.val() === null) {\r\n            await await firebase.database()\r\n                .ref(`/users/${AuthStore.user.uid}/personalchatswithusers/${otherUserUid}`)\r\n                .set({\r\n                    blocked: false\r\n                });\r\n            const snapshot2 = await firebase.database()\r\n                .ref(`/users/${otherUserUid}/personalchatswithusers/${AuthStore.user.uid}`)\r\n                .once('value');\r\n            if (snapshot2.val() === null) {\r\n                await await firebase.database()\r\n                    .ref(`/users/${otherUserUid}/personalchatswithusers/${AuthStore.user.uid}`)\r\n                    .set({\r\n                        blocked: false\r\n                    });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default new PersonalChatStore();\r\n","import React, { Component } from 'react';\nimport './PersonalChat.css';\nimport Chat from '../Chat/Chat';\nimport PersonalChatStore from '../../stores/PersonalChatStore';\n\nclass PersonalChat extends Component {\n    constructor(props) {\n        super();\n        this.state = {\n        };\n    }\n\n    componentWillMount() {\n    }\n\n    componentWillUnmount() {\n    }\n\n    render() {\n        return (\n            <div className=\"PersonalChat\">\n                <Chat {...this.props} chatStore={PersonalChatStore} />\n            </div>\n        );\n    }\n}\n\nexport default PersonalChat;\n"],"sourceRoot":""}